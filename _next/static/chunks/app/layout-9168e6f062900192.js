(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4933:function(e,r,t){Promise.resolve().then(t.bind(t,575)),Promise.resolve().then(t.t.bind(t,5573,23)),Promise.resolve().then(t.t.bind(t,7960,23))},575:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return u},a:function(){return s}});var a=t(7437),i=t(2265),l=t(9376),n=t(2141);let o=(0,i.createContext)(void 0);function u(e){let{children:r}=e,[t,u]=(0,i.useState)(null),[s,c]=(0,i.useState)(!0),[d,f]=(0,i.useState)(null),h=(0,l.useRouter)(),m=(0,l.usePathname)();(0,i.useEffect)(()=>{if((async()=>{try{if(c(!0),!n.OQ){f("Error de configuraci\xf3n del sistema. Por favor, recarga la p\xe1gina.");return}let{data:{session:r},error:t}=await n.OQ.auth.getSession();if(t)throw t;if(null==r?void 0:r.user){var e;let{data:t,error:a}=await n.OQ.from("profiles").select("*").eq("id",r.user.id).single();if(a)throw a;u({id:r.user.id,email:r.user.email,user_metadata:{full_name:(null==t?void 0:t.full_name)||(null===(e=r.user.email)||void 0===e?void 0:e.split("@")[0]),avatar_url:null==t?void 0:t.avatar_url},role:(null==t?void 0:t.role)||"CLIENTE"})}else u(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||h.push("/login")}catch(e){}finally{c(!1)}})(),!n.OQ)return()=>{};let e=n.OQ;if(!e)return()=>{};let{data:{subscription:r}}=e.auth.onAuthStateChange(async(r,t)=>{if(null==t?void 0:t.user){var a;if(!e)return;let{data:r}=await e.from("profiles").select("*").eq("id",t.user.id).single();u({id:t.user.id,email:t.user.email,user_metadata:{full_name:(null==r?void 0:r.full_name)||(null===(a=t.user.email)||void 0===a?void 0:a.split("@")[0]),avatar_url:null==r?void 0:r.avatar_url},role:(null==r?void 0:r.role)||"CLIENTE"})}else u(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||h.push("/login")});return()=>{null==r||r.unsubscribe()}},[m,h]);let g=async(e,r)=>{try{if(f(null),!n.OQ)return{error:{message:"Error de configuraci\xf3n del sistema"}};let{data:t,error:a}=await n.OQ.auth.signInWithPassword({email:e,password:r});if(a)throw Error(a.message||"Error al iniciar sesi\xf3n");if(null==t?void 0:t.user){let{data:e,error:r}=await n.OQ.from("profiles").select("*").eq("id",t.user.id).single();if(r)throw r;u({id:t.user.id,email:t.user.email||"",user_metadata:{full_name:(null==e?void 0:e.full_name)||"",avatar_url:null==e?void 0:e.avatar_url},role:(null==e?void 0:e.role)||"CLIENTE"})}return{error:null}}catch(r){let e=r.message||"Error al iniciar sesi\xf3n";return f(e),{error:e}}},_=async(e,r,t)=>{try{if(f(null),!n.OQ)return{error:{message:"Error de configuraci\xf3n del sistema"}};let{data:a,error:i}=await n.OQ.from("profiles").select("id").eq("email",e).single();if(a&&!i)throw Error("Este correo electr\xf3nico ya est\xe1 registrado");let{data:l,error:o}=await n.OQ.auth.signUp({email:e,password:r,options:{data:{full_name:t.full_name},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(o)throw o;if(l.user){let{error:r}=await n.OQ.from("profiles").insert([{id:l.user.id,email:e.toLowerCase().trim(),full_name:t.full_name.trim(),role:"CLIENTE",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]);if(r)throw Error("Error al crear el perfil del usuario")}return{error:null}}catch(r){let e=r.message||"Error al registrar el usuario";return f(e),{error:e}}},p=async e=>{try{if(f(null),!n.OQ)return{error:{message:"Error de configuraci\xf3n del sistema"}};let{error:r}=await n.OQ.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/update-password")});if(r)throw r;return{error:null}}catch(r){let e=r.message||"Error al enviar el correo de recuperaci\xf3n";return f(e),{error:e}}finally{c(!1)}},v=async()=>{try{u(null),localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{let[r]=e.trim().split("=");document.cookie="".concat(r,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}),n.OQ&&await n.OQ.auth.signOut().catch(e=>{}),window.location.href="https://hubdeseguros.github.io/v1/login/"}catch(e){window.location.href="https://hubdeseguros.github.io/v1/login/"}};return(0,a.jsx)(o.Provider,{value:{user:t,loading:s,error:d,signIn:g,signUp:_,signOut:v,resetPassword:p},children:r})}function s(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},2141:function(e,r,t){"use strict";t.d(r,{Ng:function(){return f},OQ:function(){return h}});var a=t(9950),i=t(2371),l=t(7026),n=t(257);let o="https://vcoynbjctbfyavxnyhmp.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjb3luYmpjdGJmeWF2eG55aG1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNzY4ODUsImV4cCI6MjA2Mzg1Mjg4NX0.q_5pNpcOSBpqjTkgIWoplGDc6LZlZIvTD3zeuR3lN2Q",s=n.env.SUPABASE_SERVICE_ROLE_KEY||"",c={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",debug:!1},global:{headers:{"X-Client-Info":"hubseguros/1.0.0"}}},d=()=>{try{if(!o||!u)return null;return(0,l.eI)(o,u,c)}catch(e){return null}},f=d,h=d();(()=>{try{if(!o||!s)return null;return(0,l.eI)(o,s,(0,i._)((0,a._)({},c),{auth:(0,i._)((0,a._)({},c.auth),{autoRefreshToken:!1,persistSession:!1})}))}catch(e){return null}})()},9376:function(e,r,t){"use strict";var a=t(5475);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},7960:function(){},5573:function(e){e.exports={style:{fontFamily:"'__Inter_d65c78', '__Inter_Fallback_d65c78'",fontStyle:"normal"},className:"__className_d65c78",variable:"__variable_d65c78"}}},function(e){e.O(0,[348,830,971,117,744],function(){return e(e.s=4933)}),_N_E=e.O()}]);