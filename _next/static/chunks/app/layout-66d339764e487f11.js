(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6448:function(e,r,t){Promise.resolve().then(t.bind(t,3512)),Promise.resolve().then(t.t.bind(t,5573,23)),Promise.resolve().then(t.t.bind(t,7960,23))},3512:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return d},a:function(){return h}});var a=t(7437),i=t(2265),l=t(9376),o=t(7026);let n="https://vcoynbjctbfyavxnyhmp.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjb3luYmpjdGJmeWF2eG55aG1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNzY4ODUsImV4cCI6MjA2Mzg1Mjg4NX0.q_5pNpcOSBpqjTkgIWoplGDc6LZlZIvTD3zeuR3lN2Q";if(!n||!s)throw Error("Missing Supabase configuration");let u=(0,o.eI)(n,s),c=(0,i.createContext)(void 0);function d(e){let{children:r}=e,[t,o]=(0,i.useState)(null),[n,s]=(0,i.useState)(!0),[d,h]=(0,i.useState)(null),f=(0,l.useRouter)(),m=(0,l.usePathname)();(0,i.useEffect)(()=>{(async()=>{try{s(!0);let{data:{session:r},error:t}=await u.auth.getSession();if(t)throw t;if(null==r?void 0:r.user){var e;let{data:t,error:a}=await u.from("profiles").select("*").eq("id",r.user.id).single();if(a)throw a;o({id:r.user.id,email:r.user.email,user_metadata:{full_name:(null==t?void 0:t.full_name)||(null===(e=r.user.email)||void 0===e?void 0:e.split("@")[0]),avatar_url:null==t?void 0:t.avatar_url},role:(null==t?void 0:t.role)||"CLIENTE"})}else o(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||f.push("/login")}catch(e){}finally{s(!1)}})();let{data:{subscription:e}}=u.auth.onAuthStateChange(async(e,r)=>{if(null==r?void 0:r.user){var t;let{data:e}=await u.from("profiles").select("*").eq("id",r.user.id).single();o({id:r.user.id,email:r.user.email,user_metadata:{full_name:(null==e?void 0:e.full_name)||(null===(t=r.user.email)||void 0===t?void 0:t.split("@")[0]),avatar_url:null==e?void 0:e.avatar_url},role:(null==e?void 0:e.role)||"CLIENTE"})}else o(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||f.push("/login")});return()=>{null==e||e.unsubscribe()}},[m,f]);let p=async(e,r)=>{s(!0),h(null);try{let{data:t,error:a}=await u.auth.signInWithPassword({email:e,password:r});if(a)throw Error(a.message||"Error al iniciar sesi\xf3n");if(null==t?void 0:t.user){let{data:e,error:r}=await u.from("profiles").select("*").eq("id",t.user.id).single();if(r)throw r;o({id:t.user.id,email:t.user.email||"",user_metadata:{full_name:(null==e?void 0:e.full_name)||"",avatar_url:null==e?void 0:e.avatar_url},role:(null==e?void 0:e.role)||"CLIENTE"})}return{error:null}}catch(r){let e=r.message||"Error al iniciar sesi\xf3n";return h(e),{error:e}}finally{s(!1)}},g=async(e,r,t)=>{s(!0),h(null);try{let{data:a,error:i}=await u.from("profiles").select("id").eq("email",e).single();if(a&&!i)throw Error("Este correo electr\xf3nico ya est\xe1 registrado");let{data:l,error:o}=await u.auth.signUp({email:e,password:r,options:{data:{full_name:t.full_name,email_redirect_to:"".concat(window.location.origin,"/dashboard")},emailRedirectTo:"".concat(window.location.origin,"/dashboard")}});if(o)throw o;if(l.user){let{error:r}=await u.from("profiles").insert([{id:l.user.id,email:e.toLowerCase().trim(),full_name:t.full_name.trim(),role:"CLIENTE",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]);if(r)throw Error("Error al crear el perfil del usuario")}return{error:null}}catch(r){let e=r.message||"Error al registrar el usuario";return h(e),{error:e}}finally{s(!1)}},v=async e=>{s(!0),h(null);try{let{error:r}=await u.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/update-password")});if(r)throw r;return{error:null}}catch(r){let e=r.message||"Error al enviar el correo de recuperaci\xf3n";return h(e),{error:e}}finally{s(!1)}},_=async()=>{try{o(null),localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{let[r]=e.trim().split("=");document.cookie="".concat(r,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}),u.auth.signOut().catch(e=>{}),f.push("https://hubdeseguros.github.io/v1/login/"),window.location.href="https://hubdeseguros.github.io/v1/login/"}catch(e){window.location.href="https://hubdeseguros.github.io/v1/login/"}};return(0,a.jsx)(c.Provider,{value:{user:t,loading:n,error:d,signIn:p,signUp:g,signOut:_,resetPassword:v},children:r})}function h(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},7960:function(){},5573:function(e){e.exports={style:{fontFamily:"'__Inter_6ec129', '__Inter_Fallback_6ec129'",fontStyle:"normal"},className:"__className_6ec129",variable:"__variable_6ec129"}}},function(e){e.O(0,[348,330,971,117,744],function(){return e(e.s=6448)}),_N_E=e.O()}]);