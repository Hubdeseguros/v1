(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6448:function(e,r,l){Promise.resolve().then(l.bind(l,3512)),Promise.resolve().then(l.t.bind(l,5573,23)),Promise.resolve().then(l.t.bind(l,7960,23))},3512:function(e,r,l){"use strict";l.d(r,{AuthProvider:function(){return d},a:function(){return f}});var t=l(7437),a=l(2265),i=l(9376),n=l(7026);let o="https://vcoynbjctbfyavxnyhmp.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjb3luYmpjdGJmeWF2eG55aG1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNzY4ODUsImV4cCI6MjA2Mzg1Mjg4NX0.q_5pNpcOSBpqjTkgIWoplGDc6LZlZIvTD3zeuR3lN2Q";if(!o||!u)throw Error("Missing Supabase configuration");let s=(0,n.eI)(o,u),c=(0,a.createContext)(void 0);function d(e){let{children:r}=e,[l,n]=(0,a.useState)(null),[o,u]=(0,a.useState)(!0),[d,f]=(0,a.useState)(null),h=(0,i.useRouter)(),m=(0,i.usePathname)();(0,a.useEffect)(()=>{(async()=>{try{u(!0);let{data:{session:r},error:l}=await s.auth.getSession();if(l)throw l;if(null==r?void 0:r.user){var e;let{data:l,error:t}=await s.from("profiles").select("*").eq("id",r.user.id).single();if(t)throw t;n({id:r.user.id,email:r.user.email,user_metadata:{full_name:(null==l?void 0:l.full_name)||(null===(e=r.user.email)||void 0===e?void 0:e.split("@")[0]),avatar_url:null==l?void 0:l.avatar_url},role:(null==l?void 0:l.role)||"CLIENTE"})}else n(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||h.push("/login")}catch(e){}finally{u(!1)}})();let{data:{subscription:e}}=s.auth.onAuthStateChange(async(e,r)=>{if(null==r?void 0:r.user){var l;let{data:e}=await s.from("profiles").select("*").eq("id",r.user.id).single();n({id:r.user.id,email:r.user.email,user_metadata:{full_name:(null==e?void 0:e.full_name)||(null===(l=r.user.email)||void 0===l?void 0:l.split("@")[0]),avatar_url:null==e?void 0:e.avatar_url},role:(null==e?void 0:e.role)||"CLIENTE"})}else n(null),["/","/login","/registro","/recuperar-password"].some(e=>m===e||m.startsWith("".concat(e,"/")))||h.push("/login")});return()=>{null==e||e.unsubscribe()}},[m,h]);let v=async(e,r)=>{u(!0),f(null);try{let{data:l,error:t}=await s.auth.signInWithPassword({email:e,password:r});if(t)throw Error(t.message||"Error al iniciar sesi\xf3n");if(null==l?void 0:l.user){let{data:e,error:r}=await s.from("profiles").select("*").eq("id",l.user.id).single();if(r)throw r;n({id:l.user.id,email:l.user.email||"",user_metadata:{full_name:(null==e?void 0:e.full_name)||"",avatar_url:null==e?void 0:e.avatar_url},role:(null==e?void 0:e.role)||"CLIENTE"})}return{error:null}}catch(r){let e=r.message||"Error al iniciar sesi\xf3n";return f(e),{error:e}}finally{u(!1)}},_=async(e,r,l)=>{u(!0),f(null);try{let{data:t,error:a}=await s.auth.signUp({email:e,password:r,options:{data:{full_name:l.full_name}}});if(a)throw a;if(t.user){let{error:r}=await s.from("profiles").insert([{id:t.user.id,email:e,full_name:l.full_name,role:"CLIENTE"}]);if(r)throw r;n({id:t.user.id,email:t.user.email||"",user_metadata:{full_name:l.full_name},role:"CLIENTE"})}return{error:null}}catch(r){let e=r.message||"Error al registrar el usuario";return f(e),{error:e}}finally{u(!1)}},p=async e=>{u(!0),f(null);try{let{error:r}=await s.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/update-password")});if(r)throw r;return{error:null}}catch(r){let e=r.message||"Error al enviar el correo de recuperaci\xf3n";return f(e),{error:e}}finally{u(!1)}},g=async()=>{try{n(null),localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{let[r]=e.trim().split("=");document.cookie="".concat(r,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}),s.auth.signOut().catch(e=>{}),h.push("https://hubdeseguros.github.io/v1/login/"),window.location.href="https://hubdeseguros.github.io/v1/login/"}catch(e){window.location.href="https://hubdeseguros.github.io/v1/login/"}};return(0,t.jsx)(c.Provider,{value:{user:l,loading:o,error:d,signIn:v,signUp:_,signOut:g,resetPassword:p},children:r})}function f(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},7960:function(){},5573:function(e){e.exports={style:{fontFamily:"'__Inter_6ec129', '__Inter_Fallback_6ec129'",fontStyle:"normal"},className:"__className_6ec129",variable:"__variable_6ec129"}}},function(e){e.O(0,[348,330,971,117,744],function(){return e(e.s=6448)}),_N_E=e.O()}]);